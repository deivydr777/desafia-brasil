<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script src="js/config.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking - Desafia Brasil</title>
    <!-- =============================================== -->
<!-- == SCRIPT DE VERIFICAÇÃO DE LOGIN (SEGURANÇA) == -->
<script>
    const userToken = localStorage.getItem('userToken');
    if (!userToken) {
        // Se NÃO encontrou o token, chuta o usuário para a página de login
        window.location.href = 'login.html';
    }
</script>
<!-- =============================================== -->
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- CSS Principal -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-light">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="dashboard.html">
                <i class="fas fa-graduation-cap me-2"></i>Desafia Brasil
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-home me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="simulado.html">
                            <i class="fas fa-brain me-1"></i>Simulados
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="ranking.html">
                            <i class="fas fa-trophy me-1"></i>Ranking
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <div class="user-avatar bg-primary text-white rounded-circle me-2" id="userAvatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span id="userName">Usuário</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="perfil.html">
                                <i class="fas fa-user me-2"></i>Perfil
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Sair
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4">
        <!-- Header -->
        <div class="ranking-header text-center mb-4">
            <h1 class="display-5 fw-bold text-primary">
                <i class="fas fa-trophy me-3"></i>Ranking Nacional
            </h1>
            <p class="lead text-muted">Compete com estudantes de todo o Brasil</p>
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs mb-4">
            <ul class="nav nav-pills justify-content-center" id="rankingTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="nacional-tab" data-bs-toggle="pill" data-bs-target="#nacional" 
                            onclick="loadRanking('nacional')">
                        <i class="fas fa-globe me-2"></i>Nacional
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="estado-tab" data-bs-toggle="pill" data-bs-target="#estado" 
                            onclick="loadRanking('estado')">
                        <i class="fas fa-map me-2"></i>Meu Estado
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cidade-tab" data-bs-toggle="pill" data-bs-target="#cidade" 
                            onclick="loadRanking('cidade')">
                        <i class="fas fa-map-marker-alt me-2"></i>Minha Cidade
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="materia-tab" data-bs-toggle="pill" data-bs-target="#materia" 
                            onclick="loadRanking('materia')">
                        <i class="fas fa-book me-2"></i>Por Matéria
                    </button>
                </li>
            </ul>
        </div>

        <!-- User Position Card -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="user-position-card card border-0 shadow bg-gradient-primary text-white">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="position-badge bg-warning text-dark rounded-circle mx-auto mb-2">
                                    <span class="fw-bold" id="userPosition">#142</span>
                                </div>
                                <small class="opacity-75">Sua Posição</small>
                            </div>
                            <div class="col-md-6">
                                <h5 class="fw-bold mb-1" id="userNameRanking">João Silva</h5>
                                <p class="mb-1 opacity-75">São Paulo, SP</p>
                                <div class="user-stats">
                                    <span class="me-3">
                                        <i class="fas fa-star me-1"></i>
                                        <span id="userTotalPoints">1,245</span> pontos
                                    </span>
                                    <span class="me-3">
                                        <i class="fas fa-brain me-1"></i>
                                        <span id="userSimulados">23</span> simulados
                                    </span>
                                    <span>
                                        <i class="fas fa-percentage me-1"></i>
                                        <span id="userAverage">78.5</span>% média
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="achievement-badge">
                                    <i class="fas fa-medal fa-2x text-warning mb-2"></i>
                                    <div class="small opacity-75">Estudante Dedicado</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subject Filter (for materia tab) -->
        <div class="row mb-3 d-none" id="subjectFilterRow">
            <div class="col-md-6 mx-auto">
                <select class="form-select" id="subjectSelect" onchange="loadSubjectRanking()">
                    <option value="geral">Ranking Geral</option>
                    <option value="matematica">Matemática</option>
                    <option value="portugues">Português</option>
                    <option value="historia">História</option>
                    <option value="geografia">Geografia</option>
                    <option value="fisica">Física</option>
                    <option value="quimica">Química</option>
                    <option value="biologia">Biologia</option>
                </select>
            </div>
        </div>

        <!-- Top 3 Podium -->
        <div class="podium-section mb-5">
            <div class="row justify-content-center">
                <!-- 2nd Place -->
                <div class="col-md-4 order-md-1">
                    <div class="podium-card second-place text-center">
                        <div class="podium-position bg-secondary text-white rounded-circle mx-auto mb-3">
                            <span class="fw-bold">2</span>
                        </div>
                        <div class="user-avatar-large bg-secondary text-white rounded-circle mx-auto mb-3" id="secondPlaceAvatar">
                            MS
                        </div>
                        <h5 class="fw-bold" id="secondPlaceName">Maria Santos</h5>
                        <p class="text-muted mb-2" id="secondPlaceLocation">Rio de Janeiro, RJ</p>
                        <div class="score-badge bg-secondary text-white rounded-pill">
                            <span class="fw-bold" id="secondPlacePoints">1,890</span> pontos
                        </div>
                        <div class="stats-row mt-3">
                            <small class="text-muted">
                                <span id="secondPlaceSimulados">45</span> simulados • 
                                <span id="secondPlaceAverage">89.2</span>% média
                            </small>
                        </div>
                    </div>
                </div>

                <!-- 1st Place -->
                <div class="col-md-4 order-md-2">
                    <div class="podium-card first-place text-center">
                        <div class="crown-icon text-warning mb-2">
                            <i class="fas fa-crown fa-2x"></i>
                        </div>
                        <div class="podium-position bg-warning text-dark rounded-circle mx-auto mb-3">
                            <span class="fw-bold">1</span>
                        </div>
                        <div class="user-avatar-large bg-warning text-dark rounded-circle mx-auto mb-3" id="firstPlaceAvatar">
                            AS
                        </div>
                        <h5 class="fw-bold" id="firstPlaceName">Ana Silva</h5>
                        <p class="text-muted mb-2" id="firstPlaceLocation">São Paulo, SP</p>
                        <div class="score-badge bg-warning text-dark rounded-pill">
                            <span class="fw-bold" id="firstPlacePoints">2,156</span> pontos
                        </div>
                        <div class="stats-row mt-3">
                            <small class="text-muted">
                                <span id="firstPlaceSimulados">52</span> simulados • 
                                <span id="firstPlaceAverage">92.4</span>% média
                            </small>
                        </div>
                    </div>
                </div>

                <!-- 3rd Place -->
                <div class="col-md-4 order-md-3">
                    <div class="podium-card third-place text-center">
                        <div class="podium-position bg-warning text-dark rounded-circle mx-auto mb-3">
                            <span class="fw-bold">3</span>
                        </div>
                        <div class="user-avatar-large bg-warning text-dark rounded-circle mx-auto mb-3" id="thirdPlaceAvatar">
                            PC
                        </div>
                        <h5 class="fw-bold" id="thirdPlaceName">Pedro Costa</h5>
                        <p class="text-muted mb-2" id="thirdPlaceLocation">Belo Horizonte, MG</p>
                        <div class="score-badge bg-warning text-dark rounded-pill">
                            <span class="fw-bold" id="thirdPlacePoints">1,782</span> pontos
                        </div>
                        <div class="stats-row mt-3">
                            <small class="text-muted">
                                <span id="thirdPlaceSimulados">41</span> simulados • 
                                <span id="thirdPlaceAverage">86.7</span>% média
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ranking Table -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow">
                    <div class="card-header bg-white">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h5 class="fw-bold mb-0">
                                    <i class="fas fa-list me-2"></i>
                                    Ranking Completo
                                </h5>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <div class="dropdown">
                                    <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" 
                                            data-bs-toggle="dropdown">
                                        <i class="fas fa-sort me-2"></i>Ordenar por
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="sortRanking('points')">Pontos</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="sortRanking('average')">Média</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="sortRanking('simulados')">Simulados</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="border-0 ps-4">Posição</th>
                                        <th class="border-0">Estudante</th>
                                        <th class="border-0">Localização</th>
                                        <th class="border-0 text-center">Pontos</th>
                                        <th class="border-0 text-center">Média</th>
                                        <th class="border-0 text-center">Simulados</th>
                                        <th class="border-0 text-center">Tendência</th>
                                    </tr>
                                </thead>
                                <tbody id="rankingTableBody">
                                    <!-- Ranking data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer bg-white text-center">
                        <button class="btn btn-outline-primary" id="loadMoreBtn" onclick="loadMoreRanking()">
                            <i class="fas fa-plus me-2"></i>Carregar Mais
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="row mt-5">
            <div class="col-md-3 col-6 mb-3">
                <div class="stat-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="stat-icon text-primary mb-2">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number fw-bold" id="totalUsers">50,234</div>
                    <small class="text-muted">Estudantes Ativos</small>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="stat-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="stat-icon text-success mb-2">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="stat-number fw-bold" id="totalSimulados">120,567</div>
                    <small class="text-muted">Simulados Realizados</small>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="stat-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="stat-icon text-warning mb-2">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="stat-number fw-bold" id="totalQuestions">12,456</div>
                    <small class="text-muted">Questões Disponíveis</small>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="stat-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="stat-icon text-info mb-2">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-number fw-bold" id="avgPerformance">76.8%</div>
                    <small class="text-muted">Média Nacional</small>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Ranking JS -->
    <script src="js/ranking.js"></script>
    <!-- Main JS -->
    <script src="js/main.js"></script>
    <!-- Auth JS -->
    <script src="js/auth.js"></script>

    <script>
        // Initialize ranking page
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth()) {
                window.location.href = 'login.html';
                return;
            }

            loadUserData();
            loadRanking('nacional');
        });

        function loadUserData() {
            const userData = getUserData();
            if (userData) {
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userNameRanking').textContent = userData.name;
                document.getElementById('userPosition').textContent = `#${userData.rankingPosition || 0}`;
                document.getElementById('userTotalPoints').textContent = userData.totalPoints || 0;
                document.getElementById('userSimulados').textContent = userData.simuladosCompletos || 0;
                document.getElementById('userAverage').textContent = userData.averageScore || 0;
                
                const initials = userData.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                document.getElementById('userAvatar').textContent = initials;
            }
        }

        function loadRanking(type) {
            // Show/hide subject filter for materia tab
            const subjectFilterRow = document.getElementById('subjectFilterRow');
            if (type === 'materia') {
                subjectFilterRow.classList.remove('d-none');
            } else {
                subjectFilterRow.classList.add('d-none');
            }

            // Load ranking data based on type
            const mockRankingData = generateMockRanking(type);
            displayRanking(mockRankingData);
        }

        function generateMockRanking(type) {
            // Mock data generator for demonstration
            const names = ['Ana Silva', 'João Santos', 'Maria Oliveira', 'Pedro Costa', 'Carla Ferreira'];
            const cities = ['São Paulo, SP', 'Rio de Janeiro, RJ', 'Belo Horizonte, MG', 'Salvador, BA', 'Curitiba, PR'];
            
            const ranking = [];
            for (let i = 4; i <= 50; i++) {
                ranking.push({
                    position: i,
                    name: names[Math.floor(Math.random() * names.length)],
                    location: cities[Math.floor(Math.random() * cities.length)],
                    points: Math.floor(Math.random() * 1000) + 800,
                    average: (Math.random() * 30 + 70).toFixed(1),
                    simulados: Math.floor(Math.random() * 40) + 10,
                    trend: Math.random() > 0.5 ? 'up' : 'down'
                });
            }

            return ranking.sort((a, b) => b.points - a.points);
        }

        function displayRanking(data) {
            const tbody = document.getElementById('rankingTableBody');
            tbody.innerHTML = '';

            data.forEach((user, index) => {
                const row = document.createElement('tr');
                row.className = user.position <= 10 ? 'table-warning' : '';
                
                row.innerHTML = `
                    <td class="ps-4 fw-bold">
                        <span class="position-number">#${user.position}</span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar-sm bg-primary text-white rounded-circle me-2">
                                ${user.name.split(' ').map(n => n[0]).join('').substring(0, 2)}
                            </div>
                            <span class="fw-bold">${user.name}</span>
                        </div>
                    </td>
                    <td class="text-muted">${user.location}</td>
                    <td class="text-center fw-bold">${user.points.toLocaleString()}</td>
                    <td class="text-center">${user.average}%</td>
                    <td class="text-center">${user.simulados}</td>
                    <td class="text-center">
                        <i class="fas fa-arrow-${user.trend} text-${user.trend === 'up' ? 'success' : 'danger'}"></i>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function sortRanking(criteria) {
            // Implementation for sorting ranking
            console.log(`Sorting by: ${criteria}`);
        }

        function loadMoreRanking() {
            // Implementation for loading more ranking data
            console.log('Loading more ranking data...');
        }

        function loadSubjectRanking() {
            const subject = document.getElementById('subjectSelect').value;
            console.log(`Loading ranking for subject: ${subject}`);
        }
    </script>
</body>
</html>
